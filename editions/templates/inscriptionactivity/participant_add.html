{% extends 'base.html' %}
{% load widget_tweaks %}
{% block body %}

<div class="content">
	<div class="row">

		{% if messages %}
			{% for message in messages %}
				<div class="alert alert-{{message.tags}}" role="alert" style="text-align: center; margin-top: -1.3em;">
			  		{{ message}}
				</div>
			{% endfor %}
		{% endif %}

		{% if notInscriptEdition %}
			<div class="alert alert-warning" role="alert" style="text-align: center; margin-top: -1.3em;">
		  		Você não se inscreveu em nenhume edição! Por favor, inscreva-se em uma edição.<a href="{% url 'editions:create_incription_participant' %}">Clique aqui e se inscreva</a>
			</div>
		{% endif %}
		<div class="col-md-8 col-md-offset-2">

			{% if notInscriptEdition %}

			{% else %}
				
				<h3>Inscrever-se</h3>
				
				<div class="box box-primary">
					<form action="." class="form-group" method="post">{% csrf_token %}
						<div class="box-body">
							{% for field in form %} 
							{% if field.errors %}
							<div class="form-group error" >
								<label class="control-label" >{{ field.label }}</label>
								{{ field|add_class:"form-control input-md" }}
								{% for error in field.errors%}
								<span class="help-inline error">{{ error}}</span>
								{% endfor%}
							</div>
							{%else%}
							<div class="form-group">
								<label class="control-label" >{{ field.label }}</label>
								{{ field|add_class:"form-control input-md" }}
							</div>
							{%endif%}
							{% endfor %}
							<div class="box-footer">
								<button type="submit" class="btn btn-success" style="font-weight: bold;"><i class="fa fa-check" aria-hidden="true"></i> Salvar </button>
								<a class="btn btn-danger pull-right" href="#" style="font-weight: bold;"><i class="fa fa-times" aria-hidden="true"></i> Cancelar</a>
							</div>  
						</div>
					</form>



					<section class="content-header">
						<div class="row">
							<h3 class="col-md-8">Minhas Inscrições</h3>
						</div>
						<div class="row">

						</div>
					</section>
					<div id="listItems" class="content">
						<div class="row">
							<div class="col-md-12 ">
								<div class="box box-primary">
									<div class="box-body">
										<div class="table-responsive">
											<table class="table table-hover table-condensed table-bordered table-striped">
												<thead>
													<tr class="text-center">
														<th class="text-center" width="30%">Inscrição</th>
														<th class="text-center" width="30%">Participante</th>
														<th class="text-center" width="20%">Atividade</th>
														<th class="text-center" width="20%">Edição</th>
														<th class="text-center" width="20%">Ação</th>
													</tr>
												</thead>
												<tbody>
													{% for inscription in inscriptions %}
													<tr>
														<td>{{ inscription.date_of_inscription }}</td>
														<td>{{ inscription.participant.name }}</td>
														<td>{{ inscription.activity.title}}</td>
														<td>{{ inscription.inscription.edition}}</td>


														<td class="text-center">


															<a href="#" class="btn btn-danger btn-xs deleteItem" title="Remover" data-toggle="modal" data-id="{{ inscription.id }}" >
																<i class="fa fa-trash" aria-hidden="true"></i>
															</a>

					                                        <a href="{% url 'editions:detail_activity_participant' inscription.activity.id %}" class="btn btn-info btn-xs" title="Exibir">
					                                            <i class="fa fa-eye" aria-hidden="true"></i>
					                                        </a>



														</td>


													</tr>
													{% endfor %}
												</tbody>
											</table>
										</div>

									</div>
								</div>
							</div>
						</div>
					</div>


				</div>
			{% endif %}
		</div>
	</div>
</div>

{% endblock %}

{% block scripts %}




<script>

	$('#listItems').on('click', '.deleteItem', function(e){
		var id = $( this ).attr("data-id"),
		urlDel = "../"+"inscricao-atividade-delete/" + id,
		linha_editada = $(e.currentTarget).closest('tr');
		token = "{{csrf_token}}";

		swal({
			title: "Deletar Permanentemente!",
			text: "Deseja realmente deletar essa edição?",
			type: "warning",
			showCancelButton: true,
			confirmButtonColor: "#DD6B55",
			confirmButtonText: "SIM!",
			cancelButtonText: "CANCELAR!",
			closeOnConfirm: false
		}, function(){
					 //window.location.href = "http://localhost/ce/public/admin/gerenciarbanco/delete/"+id;

					 $.ajax({
					 	url: urlDel,
					 	type: 'get',
		    		//data: { csrfmiddlewaretoken: token },

		    	})
					 .done(function(d){
					 	if ( d.code == 1 )
					 	{
					 		swal('Excluida!','Edição excluida com sucesso!',"success");

					 		linha_editada.hide();


					 	}

					 })
					 .fail(function(f){
					 	swal('Falha!','Erro ao excluir edição!',"error");
					 });

					});

	});
</script>



{{ block.super }}
{{ form.media }}
{% endblock %}
